<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>소방관 과학 퀴즈 게임</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .quiz-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .quiz-option:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        .correct {
            background-color: #28a745 !important; /* Green */
            color: white;
            border-color: #28a745;
        }
        .incorrect {
            background-color: #dc3545 !important; /* Red */
            color: white;
            border-color: #dc3545;
        }
        .disabled {
            pointer-events: none;
            opacity: 0.7;
        }
        .explanation-box {
            background-color: rgba(0,0,0,0.2);
            border-left: 4px solid #f97316; /* orange-500 */
            padding: 1rem;
            margin-top: 1rem;
        }
        .hint-box {
            background-color: rgba(0,0,0,0.2);
            border-left: 4px solid #3b82f6; /* blue-500 */
            padding: 1rem;
            margin-top: 1rem;
        }
        /* Animation style for drama text */
        #drama-text p, #drama-text div {
            transition: opacity 0.7s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-2xl mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 transition-all duration-500">
        
        <div id="start-screen" class="text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-orange-400 mb-4">🔥 소방관 과학 퀴즈 🔥</h1>
            <p class="text-gray-300 mb-8 text-lg">용감한 소방관이 되어 10개의 화재 미션을 해결하고 과학 원리를 배워보세요!</p>
            <button id="start-button" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full text-xl transition-transform duration-200 ease-in-out hover:scale-105">
                출동 준비!
            </button>
        </div>

        <div id="drama-screen" class="hidden">
            <h2 id="drama-title" class="text-2xl md:text-3xl font-bold leading-tight mb-4 text-center"></h2>
            <div id="drama-text" class="text-left bg-gray-900 p-6 rounded-lg mb-8 text-lg leading-relaxed border-l-4 border-red-500 min-h-[200px]">
                <!-- Animated drama text will be inserted here -->
            </div>
            <div class="text-center">
                <button id="show-question-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-full text-xl transition-transform duration-200 ease-in-out hover:scale-105 hidden">
                    문제 확인 및 진압 시작!
                </button>
            </div>
        </div>

        <div id="quiz-screen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <p id="stage-indicator" class="text-sm font-bold text-orange-400">STAGE 1 / 10</p>
                <p id="timer" class="text-lg font-bold text-yellow-400"></p>
                <p id="score-indicator" class="text-sm font-bold text-green-400">SCORE: 0</p>
            </div>
            <h2 id="quiz-title" class="text-2xl md:text-3xl font-bold leading-tight mb-4"></h2>
            <div id="quiz-scenario" class="bg-gray-700 p-4 rounded-lg mb-6 border-l-4 border-red-500">
                <p id="quiz-question" class="text-lg"></p>
            </div>
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Options will be inserted here by JavaScript -->
            </div>
            <div id="result-container" class="mt-6 p-4 rounded-lg hidden">
                <h3 id="result-title" class="text-xl font-bold mb-2"></h3>
                <div id="result-explanation" class="text-gray-300"></div>
            </div>
            <div class="text-center mt-8">
                <button id="retry-button" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-lg transition hidden">
                    다시 시도
                </button>
                <button id="next-stage-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition hidden">
                    다음 임무로 &rarr;
                </button>
            </div>
        </div>

        <div id="end-screen" class="hidden text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-green-400 mb-4">🎉 임무 완수! 🎉</h1>
            <p id="final-score" class="text-2xl text-white mb-4"></p>
            <p id="final-message" class="text-gray-300 mb-8 text-lg"></p>
            <button id="restart-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full text-xl transition-transform duration-200 ease-in-out hover:scale-105">
                다시 도전하기
            </button>
        </div>
    </div>

    <script>
        // DOM Elements
        const startScreen = document.getElementById('start-screen');
        const dramaScreen = document.getElementById('drama-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const endScreen = document.getElementById('end-screen');
        
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const showQuestionButton = document.getElementById('show-question-button');

        const dramaTitle = document.getElementById('drama-title');
        const dramaText = document.getElementById('drama-text');
        
        const stageIndicator = document.getElementById('stage-indicator');
        const scoreIndicator = document.getElementById('score-indicator');
        const timerElement = document.getElementById('timer');
        const quizTitle = document.getElementById('quiz-title');
        const quizQuestion = document.getElementById('quiz-question');
        const optionsContainer = document.getElementById('options-container');
        const resultContainer = document.getElementById('result-container');
        const resultTitle = document.getElementById('result-title');
        const resultExplanation = document.getElementById('result-explanation');
        const nextStageButton = document.getElementById('next-stage-button');
        const retryButton = document.getElementById('retry-button');
        
        const finalScore = document.getElementById('final-score');
        const finalMessage = document.getElementById('final-message');

        const quizData = [
            {
                title: "🚨 긴급! 치킨집 주방 화재!",
                drama: `<p class="text-xl mb-4 text-center">"삐뽀- 삐뽀- 삐뽀-"</p><p class="mb-2">무전기에서 다급한 목소리가 들려온다.</p><p class="font-bold text-red-400 mb-4">"관제센터, 관제센터! 강릉시 옥천동 상가 건물, 치킨집에서 화재 발생! 현장으로 즉시 출동 바란다!"</p><p>소방차에 올라탄 당신의 심장이 거세게 뛴다. 현장에 도착하니 자욱한 연기와 함께 사람들이 비명을 지르며 뛰쳐나오고 있다. 한 아주머니가 울부짖는다.</p><p class="font-bold text-yellow-300 mt-4">"아이고, 우리 가게! 튀김기름에 불이 붙었어요! 어떡해!"</p><p class="mt-2">당신은 소방 장비를 챙기고 결심에 찬 눈으로 불길이 치솟는 주방으로 향한다.</p>`,
                question: "끓는 기름 위로 불길이 솟구치고 있다! 일촉즉발의 상황, 당신의 첫 번째 판단은?",
                options: ["재빨리 물을 부어 불을 식힌다.", "젖은 수건이나 배추잎으로 솥을 완전히 덮는다.", "창문을 열어 신선한 공기를 통하게 한다.", "선풍기를 틀어 불을 날려버린다."],
                answer: 1,
                hint: "기름에 물을 부으면 어떻게 될까요? 불이 타려면 꼭 필요한 공기 중의 어떤 성분을 없애는 방법을 생각해보세요.",
                explanation: `<p class="mb-3">훌륭한 판단이야! 이것이 바로 <strong>'질식 소화'</strong>의 원리야.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>불이 타려면 <strong>'탈 물질', '산소', '발화점 이상의 온도'</strong>(연소의 3요소)가 필요해. 젖은 수건으로 덮는 것은 <strong>'산소'</strong> 공급을 막아 불을 끄는 가장 확실한 방법이지!</p></div>`
            },
            {
                title: "🔥 아차! 휴지통에 붙은 불!",
                drama: `<p class="mb-2">방에서 숙제를 하고 있는데 어디선가 종이 타는 냄새가 난다. 주위를 둘러보니, 돋보기 실험을 하고 무심코 창가에 둔 돋보기 때문에 햇빛이 모여 휴지통에 불이 붙었다!</p><p class="font-bold text-red-400 mb-4">"앗, 불이야!"</p><p>다행히 불길이 크지 않다. 지금이라면 충분히 끌 수 있어! 당신은 침착하게 주변을 살피며 불을 끌 방법을 찾는다.</p>`,
                question: "종이나 나무 같은 일반적인 물질에 붙은 초기 화재를 진압할 때, 가장 효과적인 방법은?",
                options: ["입으로 강하게 불어 끈다.", "물을 부어 온도를 낮춘다.", "창문을 열어 연기를 뺀다.", "마른 수건으로 덮는다."],
                answer: 1,
                hint: "종이나 나무에 붙은 불을 끌 때 가장 흔하게 사용하는 방법은 무엇일까요? 불의 3요소 중 '온도'를 빼앗는 방법을 생각해보세요.",
                explanation: `<p class="mb-3">정확해! 이것이 바로 <strong>'냉각 소화'</strong>의 원리야!</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>물을 뿌리는 것은 불이 타는 데 필요한 '발화점 이상의 온도'를 빼앗는 가장 대표적인 방법이야. 물이 증발하면서 열을 흡수하여, 타는 물질의 온도를 발화점 아래로 떨어뜨려 불을 끄는 거지. 소방관들이 화재 현장에서 물을 사용하는 가장 큰 이유야!</p></div>`
            },
            {
                title: "🔥 건조한 날, 산불 발생!",
                drama: `<p class="mb-2">가족과 함께 가을 산으로 캠핑을 왔다. 상쾌한 공기를 마시며 주변을 둘러보는데, 저 멀리서 연기가 피어오르는 것이 보인다.</p><p class="font-bold text-red-400 mb-4">"어? 저기 연기 나는 거 같은데?"</p><p>가까이 가보니, 누군가 버리고 간 담배꽁초 때문에 마른 나뭇잎 더미에 불이 붙어 점점 번지고 있다! 아직 불길이 크지 않다. 지금 잡아야 해!</p>`,
                question: "주변에 있는 물건으로 초기 진압을 해야 한다면 가장 올바른 행동은?",
                options: ["마른 나뭇가지를 이용해 불을 쳐서 끈다.", "입고 있던 옷을 벗어 불을 덮는다.", "주변의 마른 흙이나 모래를 뿌려 불을 덮는다.", "불길이 약해지도록 바람을 불어준다."],
                answer: 2,
                hint: "불을 직접 때리면 불씨가 날아갈 수 있어요. 불이 더 이상 탈 수 없도록 덮어버리는 걸 생각해보세요.",
                explanation: `<p class="mb-3">최고의 소방관이야! <strong>'질식 소화'</strong>와 <strong>'냉각 소화'</strong>를 동시에 해냈어!</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>마른 흙이나 모래를 뿌리는 것은 불을 덮어서 <strong>'산소'</strong>의 공급을 막고(질식 소화), 동시에 불의 열을 빼앗아 <strong>'발화점 이하'</strong>로 온도를 낮추지(냉각 소화). 연소의 3요소 중 두 가지를 동시에 제거하는 아주 효과적인 방법이야!</p></div>`
            },
            {
                title: "⚡️ 위험! 콘센트에서 불꽃 발생!",
                drama: `<p class="mb-2">집에서 컴퓨터 게임을 하던 중, 갑자기 모니터가 꺼지고 코 쪽으로 무언가 타는 냄새가 스며든다.</p><p class="font-bold text-red-400 mb-4">"지지직... 타타탁!"</p><p>소리가 나는 쪽을 보니, 수많은 플러그가 꽂힌 멀티탭에서 스파크가 튀며 시커먼 연기와 함께 불이 붙어있다! 당장 조치를 취해야 한다!</p>`,
                question: "전기 화재 시 가장 먼저 해야 할 일은?",
                options: ["급한 대로 물을 부어 끈다.", "두꺼비집(차단기)을 내려 전기를 차단한다.", "젖은 손으로 코드를 뽑는다.", "일반 분말 소화기를 바로 뿌린다."],
                answer: 1,
                hint: "물은 전기가 통해요. 불을 끄기 전에 먼저 해야 할 가장 중요한 안전 조치는 무엇일까요?",
                explanation: `<p class="mb-3">침착한 대응이야! 감전 사고를 막는 게 최우선이지.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>전기 화재 시 물을 뿌리면 전기가 물을 타고 흘러 감전될 수 있어 매우 위험해! 가장 먼저 차단기를 내려 전기를 끊어야 해. 전기가 차단되면 더 이상 전기 화재가 아니므로, 물이나 담요 등으로 불을 끌 수 있어.</p></div>`
            },
            {
                title: "🏕️ 캠프파이어 뒷정리",
                drama: `<p class="mb-2">친구들과의 즐거운 캠프파이어가 끝나고 모두 잠자리에 들 시간이다. 모닥불은 거의 다 꺼져가지만, 재 속에는 아직 빨간 불씨들이 남아있다.</p><p class="font-bold text-yellow-300 mb-4">"이대로 자도 괜찮을까? 밤에 바람 불면 불씨가 날아갈 수도 있는데..."</p><p>당신은 모두의 안전을 위해 불씨를 완벽하게 처리하기로 마음먹는다.</p>`,
                question: "불씨가 남지 않도록 안전하게 끄는 방법은? '냉각 소화'의 원리를 이용해 봐!",
                options: ["흙을 덮어 불씨를 숨긴다.", "바람을 불어 빨리 식힌다.", "타고 남은 재가 자연히 식도록 둔다.", "물을 충분히 부어 재의 온도를 낮춘다."],
                answer: 3,
                hint: "불이 뜨거운 이유는 '발화점'보다 온도가 높기 때문이에요. 이 온도를 어떻게 낮출 수 있을까요?",
                explanation: `<p class="mb-3">맞았어! 이것이 바로 <strong>'냉각 소화'</strong>야.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>소화의 원리 중 하나는 '발화점 이하'로 온도를 낮추는 거야. 물을 부으면 불의 뜨거운 열을 빼앗아 탈 물질의 온도를 발화점 아래로 떨어뜨려. 불씨가 보이지 않을 때까지 충분한 물을 부어주는 것이 중요해!</p></div>`
            },
            {
                title: "🔥 산불 확산 방지 작전!",
                drama: `<p class="mb-2">뉴스 속보가 TV 화면을 가득 채운다. 강원도에서 시작된 거대한 산불이 강한 바람을 타고 빠르게 번지고 있다는 소식이다.</p><p class="font-bold text-red-400 mb-4">"소방대원들은 불길이 향하는 길목의 나무들을 미리 베어내는 '맞불 작전'을 펼치고 있습니다!"</p><p>헬리콥터가 촬영한 영상에는 소방관들이 필사적으로 나무를 베어내어 넓은 공터를 만드는 모습이 보인다. 당신은 그 이유가 무엇인지 바로 알아차렸다.</p>`,
                question: "소방관들이 불이 가는 길목의 나무들을 미리 베어내는 이유는 무엇일까?",
                options: ["소방차가 지나갈 길을 만들기 위해", "바람의 방향을 바꾸기 위해", "불이 더 이상 탈 물질이 없게 하기 위해", "헬리콥터가 물을 뿌리기 쉽게 하기 위해"],
                answer: 2,
                hint: "불이 앞으로 나아가려면 먹이(탈 물질)가 필요해요. 소방관들은 불의 먹이를 어떻게 없앨 수 있을까요?",
                explanation: `<p class="mb-3">전략적인 판단이야! <strong>'제거 소화'</strong>의 원리를 정확히 알고 있구나.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>불이 계속 타려면 '탈 물질'이 반드시 필요해. 산불이 번져나갈 길목의 나무(탈 물질)를 미리 없애버리면, 불은 더 이상 번지지 못하고 자연스럽게 힘을 잃게 돼. 이것을 '제거 소화'라고 해.</p></div>`
            },
            {
                title: "킁킁! 이상한 냄새!",
                drama: `<p class="mb-2">늦은 밤, 부엌에서 물을 마시려는데 코끝에 익숙하지 않은 시큼한 냄새가 맴돈다. 가스레인지 주변으로 다가가니 냄새가 더 강해진다.</p><p class="font-bold text-yellow-300 mb-4">"어? 이거 가스 새는 냄새 같은데..."</p><p>아직 불이 붙지는 않았지만, 매우 위험한 상황이다. 작은 실수 하나가 큰 사고로 이어질 수 있다. 당신은 숨을 참고 침착하게 행동을 개시한다.</p>`,
                question: "가스가 누출된 것으로 의심될 때, 가장 먼저 해야 할 행동은?",
                options: ["냄새의 원인을 찾기 위해 라이터를 켜본다.", "환풍기를 틀어 냄새를 빨리 내보낸다.", "창문을 활짝 열어 환기시킨다.", "방향제를 뿌려 냄새를 없앤다."],
                answer: 2,
                hint: "가스가 가득한 곳에서는 아주 작은 불꽃도 위험해요. 전기를 사용하는 제품을 켜는 것은 안전할까요?",
                explanation: `<p class="mb-3">아주 중요한 안전 수칙이야! 작은 불꽃도 큰 폭발로 이어질 수 있어.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>공기 중에 가스가 많이 섞여 있으면 작은 정전기나 스위치 불꽃만으로도 폭발할 수 있어. 그래서 전기를 사용하는 환풍기, 전등 스위치를 켜는 행동은 절대 금물! 창문을 열어 가스의 농도를 낮추는 것이 가장 안전한 첫 번째 행동이야.</p></div>`
            },
            {
                title: "소화기를 사용하라!",
                drama: `<p class="mb-2">학교 복도를 지나가는데, 과학실 앞 쓰레기통에서 연기가 피어오르는 것을 발견했다! 누군가 실험하고 남은 불씨를 버린 모양이다.</p><p class="font-bold text-red-400 mb-4">"불이야!"</p><p>다행히 불길이 크지 않고, 바로 옆에 소화기가 비치되어 있다. 당신은 지체 없이 소화기를 집어 들었다. 사용법을 떠올려보자!</p>`,
                question: "소화기를 사용할 때, 가장 먼저 해야 할 일은 무엇일까?",
                options: ["손잡이를 꽉 움켜쥔다.", "안전핀을 뽑는다.", "노즐을 잡고 불을 향해 겨눈다.", "바람을 등지고 선다."],
                answer: 1,
                hint: "소화기 손잡이를 그냥 누르면 약제가 나가지 않아요. 무엇인가가 막고 있기 때문이죠.",
                explanation: `<p class="mb-3">정답! 안전핀을 뽑지 않으면 소화기는 절대 작동하지 않아.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 소화기 사용 순서</h4><p><strong>1. 안전핀을 뽑는다.</strong><br><strong>2. 노즐(호스)을 잡고 불쪽을 향한다.</strong><br><strong>3. 손잡이를 힘껏 움켜쥔다.</strong><br><strong>4. 빗자루로 쓸듯이 불의 아랫부분을 향해 골고루 분사한다.</strong> 이 순서를 꼭 기억해!</p></div>`
            },
            {
                title: "검은 연기의 정체는?",
                drama: `<p class="mb-2">화재 대피 훈련 중이다. 교관이 소리친다.</p><p class="font-bold text-yellow-300 mb-4">"화재 시 가장 위험한 것은 불길 그 자체가 아니라 바로 연기입니다! 특히 검은 연기는 아주 해롭죠!"</p><p>교관의 설명에 따르면, 이 검은 연기는 산소가 부족할 때 발생하며, 시야를 가리고 유독가스를 포함하고 있다고 한다. 당신은 이 검은 연기의 정체가 무엇인지 궁금해졌다.</p>`,
                question: "불완전 연소 시 생기는 검고 해로운 가루의 정체는 무엇일까?",
                options: ["산소", "이산화탄소", "그을음", "수증기"],
                answer: 2,
                hint: "물질이 완전히 타지 못하고 남은 검은 가루를 무엇이라고 부를까요?",
                explanation: `<p class="mb-3">맞아. 그을음은 아주 위험한 물질이야.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>산소가 부족한 상태에서 물질이 타면 '불완전 연소'가 일어나. 이때 유독가스와 함께 '그을음(탄소 가루)'이 발생해. 이 그을음은 우리 몸에 매우 해로우며, 화재 시 시야를 가려 대피를 어렵게 만들어. 그래서 화재 시에는 젖은 수건으로 코와 입을 막고 자세를 낮춰야 해.</p></div>`
            },
            {
                title: "불길은 어디로 향할까?",
                drama: `<p class="mb-2">영화 속 한 장면. 주인공이 불이 난 건물 아래층에 갇혔다. 주인공은 다급하게 외친다.</p><p class="font-bold text-red-400 mb-4">"위로 가면 안 돼! 연기 때문에 위험해! 아래로, 최대한 아래로 대피해야 해!"</p><p>왜 불이 나면 위층이 더 위험하고, 몸을 낮춰 대피해야 하는 걸까? 불과 뜨거운 연기의 움직임에는 중요한 과학 원리가 숨어있다.</p>`,
                question: "불길과 뜨거운 연기는 주로 어느 방향으로 향할까? 이 현상 때문에 높은 곳이 더 위험해.",
                options: ["아래쪽으로 가라앉는다.", "창문 쪽으로 향한다.", "위쪽으로 솟구친다.", "사방으로 똑같이 퍼진다."],
                answer: 2,
                hint: "뜨거운 공기는 가벼울까요, 무거울까요? 가벼운 것은 위로 갈까요, 아래로 갈까요?",
                explanation: `<p class="mb-3">정확해! 이것이 바로 <strong>'대류'</strong> 현상이야.</p><div class="explanation-box"><h4 class="font-bold text-orange-400 mb-2">🔬 과학 원리 탐구</h4><p>공기는 뜨거워지면 가벼워져서 위로 올라가고, 차가운 공기는 무거워서 아래로 내려와. 불로 인해 뜨거워진 공기와 연기는 빠르게 위로 올라가 천장을 뜨겁게 만들고, 불이 더 쉽게 번지게 해. 그래서 화재 시 대피할 때는 몸을 낮춰야 하는 거야.</p></div>`
            },
        ];

        let currentQuizIndex = 0;
        let score = 0;
        let answeredCorrectly = false;
        let timerInterval;
        let timeLeft;
        const TIME_LIMIT = 20;

        function startGame() {
            currentQuizIndex = 0;
            score = 0;
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            loadStage();
        }

        function loadStage() {
            answeredCorrectly = false;
            const currentQuiz = quizData[currentQuizIndex];
            
            dramaTitle.textContent = currentQuiz.title;
            quizScreen.classList.add('hidden');
            dramaScreen.classList.remove('hidden');
            
            animateDramaText(currentQuiz.drama, dramaText, () => {
                showQuestionButton.classList.remove('hidden');
            });

            stageIndicator.textContent = `STAGE ${currentQuizIndex + 1} / ${quizData.length}`;
            scoreIndicator.textContent = `SCORE: ${score}`;
            quizTitle.textContent = currentQuiz.title;
            quizQuestion.textContent = currentQuiz.question;
            
            resultContainer.classList.add('hidden');
            nextStageButton.classList.add('hidden');
            retryButton.classList.add('hidden');
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('disabled');
            
            currentQuiz.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.innerHTML = option;
                button.classList.add('quiz-option', 'w-full', 'p-4', 'bg-gray-600', 'rounded-lg', 'text-left', 'transition', 'duration-200', 'hover:bg-gray-500');
                button.dataset.index = index;
                button.addEventListener('click', selectAnswer);
                optionsContainer.appendChild(button);
            });
        }
        
        function animateDramaText(htmlString, element, callback) {
            element.innerHTML = '';
            showQuestionButton.classList.add('hidden');
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlString;
            const children = Array.from(tempDiv.children);
            let i = 0;
            function revealNext() {
                if (i < children.length) {
                    const child = children[i];
                    child.style.opacity = '0';
                    element.appendChild(child);
                    void child.offsetWidth; 
                    child.style.opacity = '1';
                    i++;
                    setTimeout(revealNext, 1800);
                } else {
                    if (callback) setTimeout(callback, 500);
                }
            }
            revealNext();
        }

        function showQuestionView() {
            dramaScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = TIME_LIMIT;
            timerElement.textContent = `남은 시간: ${timeLeft}`;
            timerElement.style.color = '#facc15'; // yellow-400

            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `남은 시간: ${timeLeft}`;
                if (timeLeft < 6) {
                    timerElement.style.color = '#f87171'; // red-400
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeUp();
                }
            }, 1000);
        }

        function handleTimeUp() {
            optionsContainer.classList.add('disabled');
            resultTitle.textContent = "⏰ 시간 초과! 힌트를 보고 다시 시도해 보세요.";
            resultTitle.style.color = '#f87171';
            resultExplanation.innerHTML = `<div class="hint-box"><h4 class="font-bold text-blue-400 mb-2">💡 힌트</h4><p>${quizData[currentQuizIndex].hint}</p></div>`;
            resultContainer.classList.remove('hidden');
            retryButton.classList.remove('hidden');
            nextStageButton.classList.add('hidden');
        }

        function retryQuestion() {
            resultContainer.classList.add('hidden');
            retryButton.classList.add('hidden');
            optionsContainer.classList.remove('disabled');
            Array.from(optionsContainer.children).forEach(btn => {
                btn.classList.remove('incorrect', 'correct');
            });
            startTimer();
        }

        function selectAnswer(e) {
            clearInterval(timerInterval); // Stop the timer
            const selectedButton = e.currentTarget;
            const selectedIndex = parseInt(selectedButton.dataset.index);
            const currentQuiz = quizData[currentQuizIndex];
            const correctIndex = currentQuiz.answer;

            optionsContainer.classList.add('disabled');

            if (selectedIndex === correctIndex) {
                if (!answeredCorrectly) {
                    score++;
                    answeredCorrectly = true;
                }
                selectedButton.classList.add('correct');
                resultTitle.textContent = "✅ 정답입니다!";
                resultTitle.style.color = '#34d399';
                resultExplanation.innerHTML = currentQuiz.explanation;
                nextStageButton.classList.remove('hidden');
                retryButton.classList.add('hidden');
            } else {
                selectedButton.classList.add('incorrect');
                resultTitle.textContent = "❌ 오답입니다! 힌트를 확인하고 다시 풀어보세요.";
                resultTitle.style.color = '#f87171';
                resultExplanation.innerHTML = `<div class="hint-box"><h4 class="font-bold text-blue-400 mb-2">💡 힌트</h4><p>${currentQuiz.hint}</p></div>`;
                retryButton.classList.remove('hidden');
                nextStageButton.classList.add('hidden');
            }
            
            scoreIndicator.textContent = `SCORE: ${score}`;
            resultContainer.classList.remove('hidden');
        }

        function showNextStage() {
            currentQuizIndex++;
            if (currentQuizIndex < quizData.length) {
                loadStage();
            } else {
                showEndScreen();
            }
        }
        
        function showEndScreen() {
            quizScreen.classList.add('hidden');
            dramaScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            finalScore.textContent = `최종 점수: ${quizData.length}개 중 ${score}개 정답!`;
            
            let message = "훌륭해요! 당신은 최고의 과학 소방관입니다!";
            if (score < 5) {
                message = "아쉬워요! 다시 도전해서 최고의 소방관이 되어보세요!";
            } else if (score < 9) {
                message = "대단해요! 조금만 더 노력하면 완벽한 소방관이 될 수 있어요!";
            }
            finalMessage.textContent = message;
        }

        // Event Listeners
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        showQuestionButton.addEventListener('click', showQuestionView);
        nextStageButton.addEventListener('click', showNextStage);
        retryButton.addEventListener('click', retryQuestion);
    </script>
</body>
</html>
